<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Math Toolkit | Reinisch Classroom</title>

  <style>
    :root {
      --gap: 1rem;
      --ink: #e8edf5;
      --glass: rgba(255,255,255,.14);
      --glass-brd: rgba(255,255,255,.28);
      --card-brd: rgba(255,255,255,.22);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      line-height: 1.5;
      color: var(--ink);
      background: transparent;
    }
    /* Layout */
    .container { max-width: 1100px; margin: 0 auto; padding: 1rem; }

    /* Glass buttons (match home style) */
    .btn{background:var(--glass); border:1px solid var(--glass-brd); color:#fff; padding:.6rem 1rem;
         border-radius:.6rem; text-decoration:none; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
         transition: background .2s, transform .2s}
    .btn:hover{background:rgba(255,255,255,.24); transform: translateY(-1px)}

    /* Header actions */
    .home{position:fixed; top:1rem; left:1rem; z-index:1}

    /* Grid of modules (thumbnail + description only, whole card clickable) */
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: var(--gap); padding-top: 3.5rem; }
    .card-link { display:block; color: inherit; text-decoration:none; }
    .card { border:1px solid var(--card-brd); border-radius: 1rem; overflow:hidden; background: rgba(0,0,0,.25); }
    .thumb { width: 100%; aspect-ratio: 16/9; object-fit: cover; display:block; }
    .desc { padding: .85rem 1rem; color: #f0f4ff; min-height: 3rem; }

    /* Empty state */
    .empty { border: 1px dashed var(--glass-brd); border-radius: 10px; padding: 1rem; background: rgba(0,0,0,.18); color:#dfe8ff; }

    /* Search (optional) */
    .controls { position: sticky; top: .75rem; display:flex; justify-content:flex-end; z-index: 1; }
    .search { padding: 0.6rem 0.75rem; border: 1px solid var(--glass-brd); border-radius: 8px; width: 260px; max-width: 100%; background: rgba(0,0,0,.25); color: #fff; }
    .search::placeholder{color:#c7d2fe}
  </style>

  <script>
    // Load shared site assets (CSS/JS) to get the same background as the home page
    (function(){
      var root = location.pathname.indexOf('/site/') >= 0
        ? location.pathname.slice(0, location.pathname.indexOf('/site/') + 6)
        : '/';
      function addCSS(href){ var l=document.createElement('link'); l.rel='stylesheet'; l.href=href; document.head.appendChild(l); }
      function addJS(src){ var s=document.createElement('script'); s.defer=true; s.src=src; document.head.appendChild(s); }
      addCSS(root + 'assets/css/site.css');
      addJS(root + 'assets/js/site.js');
    })();
  </script>
</head>
<body>
  <!-- Static background anchor (video + overlay will be injected by site.js before this element) -->
  <div class="bg"></div>

  <!-- Fixed Home button (glass) -->
  <a class="btn home" href="/">Home</a>

  <div class="container">
    <header class="container" style="padding-top:2.5rem;">
      <h1 style="margin:0 0 .25rem; font-size: clamp(1.75rem, 3.5vw, 2.25rem);">Math Toolkit</h1>
      <p style="margin:.25rem 0 1rem; opacity:.95; max-width: 72ch;">Explore math modules. Click a card to open the module. Use Teacher Tools to add or update modules.</p>
      <div class="controls">
        <input class="search" id="search" type="search" placeholder="Search modules..." aria-label="Search modules" />
      </div>
    </header>

    <main class="container" style="padding-top:0;">
      <div id="modules" class="grid" role="list"></div>
      <div id="empty" class="empty" hidden>
        <p>No modules yet. Teachers can upload modules via Teacher Tools.</p>
      </div>
    </main>
  </div>

  <script>
    const listEl = document.getElementById('modules');
    const emptyEl = document.getElementById('empty');
    const searchEl = document.getElementById('search');
    let allModules = [];

    function cardTemplate(m) {
      const thumb = m.thumbnail ? `<img class="thumb" src="${m.thumbnail}" alt="" loading="lazy" decoding="async">` : '';
      const desc = m.description ? `${m.description}` : 'Module';
      // Route through viewer so every module shows a persistent back button without modifying module files
      const viewerURL = `./viewer.html?p=${encodeURIComponent(m.url)}`;
      return `
        <a class="card-link" href="${viewerURL}" role="listitem" aria-label="Open module">
          <article class="card">
            ${thumb}
            <div class="desc">${desc}</div>
          </article>
        </a>
      `;
    }

    function render(items) {
      listEl.innerHTML = items.map(cardTemplate).join('');
      listEl.hidden = items.length === 0;
      emptyEl.hidden = items.length !== 0;
    }

    function filter(query) {
      const q = (query || '').trim().toLowerCase();
      if (!q) return allModules;
      return allModules.filter(m =>
        (m.title || '').toLowerCase().includes(q) ||
        (m.description || '').toLowerCase().includes(q)
      );
    }

    async function load() {
      try {
        const res = await fetch('./modules.json?' + Date.now(), { cache: 'no-store' });
        if (!res.ok) throw new Error('modules.json not found');
        const data = await res.json();
        allModules = Array.isArray(data) ? data : (data.modules || []);
        render(allModules);
      } catch (e) {
        console.warn('Failed to load modules.json', e);
        allModules = [];
        render(allModules);
      }
    }

    searchEl.addEventListener('input', () => render(filter(searchEl.value)));
    load();
  </script>
</body>
</html>
